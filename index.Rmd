---
title: "Data Science for Public Policy"
author: "Nathalie Kirsch and Vanaaisha Pamnani"
output: html_document
urlcolor: blue
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r include = FALSE}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

### PPOL 670 | Assignment 4
### Data Visualization, Markdown, and Git

The four data visualizations in this document were created using the following source:

[72 Small and Medium-Size Cities Built Environment and Health Equity Dataset](https://datacatalog.urban.org/dataset/72-small-and-medium-size-cities-built-environment-and-health-equity-dataset)

This Urban Institute data set includes summary demographics, economic and 
housing demographics, and health indicators for 72 small and medium-size cities
across the country. The research team interviewed stakeholders from 19 of the 
cities included in the data set. The remaining 53 cities were selected as “peer”
cities that shared one for more of the following characteristics with many of 
the 19 cities: similar city type (suburban, central city, etc.), range of 
population (small or medium-sized), and location within the same metropolitan
region or the same state/part of the country. All collected data are for the
most recent year available as of May 22, 2020.

Within this data, we are investigating unemployment rates in 72 small and 
medium-size cities across the country, specifically by region.From this data,
we can see that unemployment rates vary across different regions and more 
importantly, how a population trends  

```{r}
library(tidyverse)
library(ggplot2)
library(readxl)
library(ggthemes)
```

```{r}
data <- read_xlsx(path = "data/Built Environment Health Equity Data Table.xlsx", sheet = "City data", range = "A2:AU72") %>%
  janitor::clean_names()
```
/newpage

Data Visualization #1

```{r}
data %>%
  mutate(unemployment = total_unemployment_percent/100) %>%
  ggplot(aes(region, unemployment , color = region, stroke = 5, ymin = 0)) + 
    geom_boxplot(outlier.colour="black", outlier.shape=16,outlier.size=2, notch=FALSE) +
    stat_summary(fun.y=mean, geom="point", shape=16) + 
     scale_y_continuous(labels = scales::percent) + 
     labs(
       x = "Region",
       y = "Total Unemployment (%)",
       title = "Total Unemployment",
       subtitle = "By Region",
       caption = "Urban Institute. 2020. 72 Small and Medium-Size Cities Built Environment and Health Equity Dataset.",
       color = "Region"
     ) +
  theme_minimal()

```

Data Visualization #2

```{r}
data %>%
  mutate(unemployment = total_unemployment_percent/100) %>%
  ggplot(aes(population_trend, unemployment, color = population_trend, ymin = 0)) +  
  geom_point(alpha = 0.6, size = 2.5) +
  facet_wrap(~region) + 
  scale_y_continuous(labels = scales::percent) +
       labs(
       x = "Population Trend",
       y = "Total Unemployment (%)",
       title = "Population Trend v. Total Unemployment (%)",
       subtitle = "By Region",
       caption = "Urban Institute. 2020. 72 Small and Medium-Size Cities Built Environment and Health Equity Dataset.",
       color = "Population Trend"
       ) + 
  theme_minimal()

```

\newpage

```{r}
#Percent Change in Population From 2013 to 2018 By Region
data %>%
  mutate(percent_pop_change = ((population_2018 - population_2013)/population_2013)) %>%
  group_by(region) %>%
  summarize(mean_pop_change = mean(percent_pop_change)) %>%
  ggplot(mapping = aes(x = region, y = mean_pop_change, fill = region, ymin = 0)) +
  geom_col() +
  labs (
    title = "Percent Change in Population From 2013 to 2018",
    subtitle = "By Region",
    x = "Region",
    y = "Percent Change in Population",
    caption = "Urban Institute. 2020. 72 Small and Medium-Size Cities Built Environment and Health Equity Dataset.",
  ) + 
  scale_fill_discrete(name="Region") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal()
```

```{r}
#Relationship Between Unemployment and Opioid Overdose Deaths
data %>%
  filter(!opioid_overdose_deaths == "NA") %>%
  mutate(opioid_overdose_deaths = as.numeric(opioid_overdose_deaths),
         unemployment = total_unemployment_percent/100) %>%
  group_by(region) %>%
  ggplot(mapping = aes(x = unemployment, y = opioid_overdose_deaths, xmin = 0, ymin = 0, color = region)) +
  geom_smooth(method = "lm", se = FALSE, alpha = 0.3) +
  geom_point(alpha = 0.8) + 
  geom_text(aes(label=ifelse(opioid_overdose_deaths>115,as.character(city),'')), hjust=-0.05, vjust=0) +
  labs (
    title = "Relationship Between Unemployment Rate and Opioid Overdose Deaths",
    subtitle = "By Region",
    x = "Total Unemployment (%)",
    y = "Number of Opioid Overdose Deaths per 100,000 (2017)",
    caption = "Urban Institute. 2020. 72 Small and Medium-Size Cities Built Environment and Health Equity Dataset.",
    color = "Region"
  ) + 
  scale_x_continuous(labels = scales::percent) +
  theme_minimal()
```
